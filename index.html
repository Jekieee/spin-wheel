<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>幸运转盘</title>
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    margin-top: 40px;
    font-size: 32px;
    color: #333;
    letter-spacing: 1px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  #wheel-container {
    position: relative;
    width: 360px;
    height: 360px;
    margin: 20px 0;
  }

  #wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 8px solid #fff;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    background: #fff;
  }

  #pointer {
    position: absolute;
    top: -22px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-bottom: 32px solid #ff4d4f;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  button {
    padding: 12px 26px;
    font-size: 16px;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    color: white;
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transition: 0.2s ease;
  }
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
  }
  button:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  }
  button:disabled {
    background: #b0c4de;
    cursor: default;
    box-shadow: none;
  }

  #result {
    margin-top: 16px;
    font-size: 20px;
    color: #333;
    font-weight: bold;
    opacity: 0;
    transition: opacity .3s ease;
  }

</style>
</head>
<body>

<h1>幸运转盘</h1>

<div id="wheel-container">
  <canvas id="wheel"></canvas>
  <div id="pointer"></div>
</div>

<button id="spin-btn">开始抽取</button>

<div id="result"></div>

<script>
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");
  const spinBtn = document.getElementById("spin-btn");
  const resultDiv = document.getElementById("result");

  // 设置画布大小
  const size = 360;
  canvas.width = size;
  canvas.height = size;

  // 默认选项
  const items = [
    "学习 30 分钟",
    "刷手机 10 分钟",
    "喝水走动",
    "写作业",
    "复习讲义",
    "准备简历",
    "做项目",
    "整理房间"
  ];

  let currentAngle = 0;
  let spinning = false;

  // 随机配色
  const colors = items.map((_, i) => {
    const hue = (360 * i) / items.length;
    return `hsl(${hue}, 75%, 60%)`;
  });

  function drawWheel() {
    const radius = size / 2;
    const cx = radius;
    const cy = radius;
    const slice = (2 * Math.PI) / items.length;

    ctx.clearRect(0, 0, size, size);

    for (let i = 0; i < items.length; i++) {
      const angle = currentAngle + i * slice;

      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.arc(cx, cy, radius - 5, angle, angle + slice);
      ctx.closePath();
      ctx.fillStyle = colors[i];
      ctx.fill();

      // 写文字
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(angle + slice / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#fff";
      ctx.font = "18px system-ui";
      ctx.fillText(items[i], radius - 25, 6);
      ctx.restore();
    }

    // 中心圆
    ctx.beginPath();
    ctx.arc(cx, cy, 38, 0, 2 * Math.PI);
    ctx.fillStyle = "#ffffff";
    ctx.fill();
    ctx.strokeStyle = "#ddd";
    ctx.lineWidth = 3;
    ctx.stroke();
  }

  drawWheel();

  function spin() {
    if (spinning) return;
    spinning = true;
    spinBtn.disabled = true;
    resultDiv.style.opacity = 0;

    const slice = (2 * Math.PI) / items.length;

    // 多转几圈再停
    const extraTurns = 4 + Math.random() * 3;
    const targetAngle = currentAngle + extraTurns * 2 * Math.PI + Math.random() * 2 * Math.PI;

    const duration = 3500;
    const start = performance.now();
    const startAngle = currentAngle;

    function animate(now) {
      const t = now - start;
      const progress = Math.min(t / duration, 1);
      const easeOut = 1 - Math.pow(1 - progress, 3);

      currentAngle = startAngle + (targetAngle - startAngle) * easeOut;
      drawWheel();

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        spinning = false;
        spinBtn.disabled = false;

        // 角度归一化
        const normalized = (currentAngle % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);

        // 指针在上方：上方方向为角度 -π/2
        const pointerAngle = (3 * Math.PI / 2 - normalized + 2 * Math.PI) % (2 * Math.PI);

        const index = Math.floor(pointerAngle / slice);
        const result = items[index];

        resultDiv.textContent = "结果：" + result;
        resultDiv.style.opacity = 1;
      }
    }

    requestAnimationFrame(animate);
  }

  spinBtn.addEventListener("click", spin);
</script>

</body>
</html>
